"""Начинающий предприниматель Александр открыл свою
первую пиццерию. Для учета заказов он использует максимально простой
инструмент – записывает в блокнот информацию о дате заказа, названии
пиццы и стоимости заказа (стоимость одной и той же пиццы даже в один и тот
же день может быть разной – это зависит от дополнительных ингредиентов,
которые пожелал добавить клиент, но которые Александр в своем блокноте
никак не учитывает). По прошествии нескольких дней Александр хочет
извлечь из своих записей какую-нибудь полезную информацию. Напишите
программу, которая будет выводить:
а) список всех пицц с указанием, сколько раз их заказывали; список должен
быть отсортирован по убыванию количества заказов, то есть первой в списке
должна оказаться самая популярная пицца;
б) список всех дат с указанием суммарной стоимости проданных в этот день
пицц; список должен быть отсортирован хронологически;
в) информацию о самом дорогом заказе;
г) среднюю стоимость заказа (среднее арифметическое по всем
Формат входных и выходных данных определите самостоятельно."""
from datetime import datetime
def analyze_pizza_orders(filename):
    try:
        # Создаем пустой список для хранения всех заказов
        orders = []

        # Открываем файл с данными о заказах
        with open(filename, 'r', encoding='utf-8') as file:
            # Читаем файл построчно
            for line_num, line in enumerate(file, 1):
                line = line.strip()  # Убираем лишние пробелы в начале и конце
                if not line:  # Пропускаем пустые строки
                    continue

                # Разделяем строку на части по запятой
                parts = line.split(', ')
                if len(parts) < 3:
                    print(f"Ошибка в строке {line_num}: недостаточно данных")
                    continue

                # Извлекаем данные из строки
                date_str = parts[0]  # Дата идет первой
                pizza_name = ', '.join(parts[1:-1])  # Название пиццы - все между датой и ценой
                try:
                    cost = float(parts[-1])  # Цена идет последней
                    # Добавляем заказ в общий список
                    orders.append((date_str, pizza_name, cost))
                except ValueError:
                    print(f"Ошибка в строке {line_num}: неверный формат цены")

        # Проверяем, есть ли данные для анализа
        if not orders:
            print("Нет данных для анализа")
            return

        # а) Список всех пицц с указанием сколько раз их заказывали
        # Создаем словарь: ключ - название пиццы, значение - количество заказов
        pizza_dict = {}
        for date, pizza, cost in orders:
            # Если пиццы еще нет в словаре - добавляем с count=0, иначе увеличиваем счетчик
            pizza_dict[pizza] = pizza_dict.get(pizza, 0) + 1

        # Сортировка по убыванию количества заказов (самые популярные сначала)
        sorted_pizzas = sorted(pizza_dict.items(), key=lambda x: x[1], reverse=True)

        print("Статистика по пиццам (название: кол-во заказов)")
        for pizza, count in sorted_pizzas:
            print(f"{pizza}: {count}")
        print()

        # б) Список всех дат с указанием суммарной выручки за день
        date_dict = {}
        for date, pizza, cost in orders:
            # Суммируем стоимость всех заказов за каждую дату
            date_dict[date] = date_dict.get(date, 0) + cost

        # Сортировка дат в хронологическом порядке
        sorted_dates = sorted(date_dict.items(), key=lambda x: datetime.strptime(x[0], '%Y-%m-%d'))

        print("Статистика по датам (дата: суммарная стоимость)")
        for date, total_cost in sorted_dates:
            print(f"{date}: {total_cost:.2f}")
        print()

        # в) Информация о самом дорогом заказе
        max_order = max(orders, key=lambda x: x[2])
        print("Самый дорогой заказ")
        print(f"Дата: {max_order[0]}")
        print(f"Пицца: {max_order[1]}")
        print(f"Стоимость: {max_order[2]:.2f}")
        print()

        # г) Средняя стоимость заказа
        total_cost = sum(cost for _, _, cost in orders)
        # Делим на количество заказов
        average_cost = total_cost / len(orders)
        print("Средняя стоимость заказа")
        print(f"{average_cost:.2f}")

    except FileNotFoundError:
        print(f"Файл {filename} не найден!")
        print("Убедитесь, что файл находится в той же папке, что и код")

filename = "pizza.txt"
analyze_pizza_orders(filename)